<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hbee Outreach - AI Email Tool</title>
    
    <!-- Critical CSS inline for fast loading -->
    <style>
        /* Top Loading Bar */
        #topLoader {
            position: fixed;
            top: 0;
            left: 0;
            width: 0%;
            height: 3px;
            background: linear-gradient(90deg, #3b82f6, #10b981);
            z-index: 1000;
            transition: width 0.3s ease;
            display: none;
        }
        #loaderText {
            position: fixed;
            top: 10px;
            right: 20px;
            background: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            color: #3b82f6;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            z-index: 1001;
            display: none;
        }
        .dark #loaderText {
            background: #1e293b;
            color: #60a5fa;
        }
        
        /* Email List - Compact Grid */
        .email-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 8px;
            max-height: 300px;
            overflow-y: auto;
            padding: 4px;
        }
        .email-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            font-size: 13px;
            height: 40px;
            transition: all 0.2s;
        }
        .dark .email-item {
            background: #1e293b;
            border-color: #374151;
            color: #f1f5f9;
        }
        .email-item:hover {
            border-color: #3b82f6;
            transform: translateY(-1px);
        }
        .email-item.sent {
            opacity: 0.6;
            background: #f0fdf4;
            border-color: #bbf7d0;
        }
        .dark .email-item.sent {
            background: #064e3b;
            border-color: #047857;
        }
        .email-number {
            font-weight: 600;
            color: #6b7280;
            min-width: 25px;
        }
        .dark .email-number {
            color: #9ca3af;
        }
        .email-address {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            margin: 0 8px;
        }
        .send-btn {
            color: #3b82f6;
            background: none;
            border: none;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s;
            flex-shrink: 0;
        }
        .dark .send-btn {
            color: #60a5fa;
        }
        .send-btn:hover {
            background: rgba(59, 130, 246, 0.1);
        }
        .send-btn.sent {
            color: #10b981;
        }
        .send-btn.sent svg {
            display: none;
        }
        .send-btn.sent::after {
            content: "✓";
            font-weight: bold;
        }
        
        /* AI Template Styling */
        .ai-template-card {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 12px;
            background: white;
            transition: all 0.2s;
        }
        .dark .ai-template-card {
            background: #1e293b;
            border-color: #374151;
        }
        .ai-template-card:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
        }
        .ai-badge {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
            font-size: 10px;
            padding: 2px 8px;
            border-radius: 12px;
        }
    </style>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            500: '#3b82f6',
                            600: '#2563eb',
                        },
                        secondary: {
                            500: '#10b981',
                            600: '#059669',
                        },
                        accent: {
                            500: '#8b5cf6',
                            600: '#7c3aed',
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-100">
    <!-- Top Loading Bar -->
    <div id="topLoader"></div>
    <div id="loaderText">Loading...</div>
    
    <!-- Navigation -->
    <nav class="sticky top-0 z-50 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700">
        <div class="container mx-auto px-4 py-3">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-primary-500 to-secondary-500 rounded-xl flex items-center justify-center">
                        <svg class="w-6 h-6 text-white" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 2L3 7V17L12 22L21 17V7L12 2Z" fill="currentColor"/>
                            <path d="M12 12L8 10V14L12 16L16 14V10L12 12Z" fill="white"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold">Hbee Outreach</h1>
                        <p class="text-xs text-gray-500 dark:text-gray-400">AI-Powered Email Tool</p>
                    </div>
                </div>
                <button id="themeToggle" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                    <svg id="lightIcon" class="w-5 h-5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 17C14.7614 17 17 14.7614 17 12C17 9.23858 14.7614 7 12 7C9.23858 7 7 9.23858 7 12C7 14.7614 9.23858 17 12 17Z" stroke="currentColor" stroke-width="2"/>
                        <path d="M12 1V3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        <path d="M12 21V23" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        <path d="M4.22 4.22L5.64 5.64" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        <path d="M18.36 18.36L19.78 19.78" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        <path d="M1 12H3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        <path d="M21 12H23" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        <path d="M4.22 19.78L5.64 18.36" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        <path d="M18.36 5.64L19.78 4.22" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-6">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Left Column -->
            <div class="lg:col-span-2 space-y-6">
                <!-- AI Templates Section -->
                <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold flex items-center gap-2">
                            <svg class="w-5 h-5 text-accent-500" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M9.663 17H4.495C3.219 17 2.188 15.969 2.188 14.693V4.496C2.188 3.22 3.22 2.188 4.495 2.188H15.692C16.968 2.188 18 3.22 18 4.496V9.663M7.5 14.5L9.5 16.5L14.5 11.5M21.378 15.622C21.378 18.742 18.856 21.264 15.736 21.264C12.616 21.264 10.094 18.742 10.094 15.622C10.094 12.502 12.616 9.98 15.736 9.98C18.856 9.98 21.378 12.502 21.378 15.622Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            AI Smart Templates
                        </h3>
                        <button id="generateAiTemplate" class="text-sm px-3 py-1 rounded-lg bg-gradient-to-r from-accent-500 to-accent-600 text-white hover:opacity-90">
                            Generate AI Template
                        </button>
                    </div>
                    
                    <!-- Template Categories -->
                    <div class="mb-4">
                        <div class="text-sm font-medium mb-2 text-gray-600 dark:text-gray-400">Categories:</div>
                        <div class="flex flex-wrap gap-2">
                            <button data-category="sales" class="text-sm px-3 py-1.5 rounded-full bg-primary-100 dark:bg-primary-900/30 text-primary-700 dark:text-primary-300">
                                Sales Outreach
                            </button>
                            <button data-category="followup" class="text-sm px-3 py-1.5 rounded-full bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300">
                                Follow-up
                            </button>
                            <button data-category="networking" class="text-sm px-3 py-1.5 rounded-full bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300">
                                Networking
                            </button>
                            <button data-category="newsletter" class="text-sm px-3 py-1.5 rounded-full bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300">
                                Newsletter
                            </button>
                        </div>
                    </div>
                    
                    <!-- AI Templates Container -->
                    <div id="aiTemplates" class="space-y-3">
                        <!-- Templates will load here -->
                    </div>
                </div>

                <!-- Campaign Setup -->
                <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6">
                    <h3 class="text-lg font-semibold mb-6">Campaign Setup</h3>
                    
                    <form id="campaignForm" class="space-y-6">
                        <!-- Quick Templates -->
                        <div class="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-xl">
                            <div class="text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">Quick Templates:</div>
                            <div class="flex flex-wrap gap-2">
                                <button type="button" data-template="professional" class="text-sm px-3 py-1.5 rounded-full bg-white dark:bg-gray-600 border border-gray-200 dark:border-gray-500">
                                    Professional Intro
                                </button>
                                <button type="button" data-template="followup" class="text-sm px-3 py-1.5 rounded-full bg-white dark:bg-gray-600 border border-gray-200 dark:border-gray-500">
                                    Follow-up
                                </button>
                                <button type="button" data-template="cold" class="text-sm px-3 py-1.5 rounded-full bg-white dark:bg-gray-600 border border-gray-200 dark:border-gray-500">
                                    Cold Outreach
                                </button>
                                <button type="button" data-template="partnership" class="text-sm px-3 py-1.5 rounded-full bg-white dark:bg-gray-600 border border-gray-200 dark:border-gray-500">
                                    Partnership
                                </button>
                            </div>
                        </div>

                        <!-- Recipients -->
                        <div>
                            <label class="block text-sm font-medium mb-2">Recipients</label>
                            <textarea 
                                id="recipients" 
                                class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 px-4 py-3 text-sm"
                                placeholder="Enter emails (one per line)"
                                rows="4"
                            ></textarea>
                            <div class="text-sm text-gray-500 mt-2">
                                <span id="validCount">0</span> valid • <span id="totalCount">0</span> total
                            </div>
                        </div>

                        <!-- Subject -->
                        <div>
                            <label class="block text-sm font-medium mb-2">Email Subject</label>
                            <input 
                                type="text" 
                                id="subject" 
                                class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 px-4 py-3 text-sm"
                                placeholder="Subject line - Use {name} and {company}"
                            />
                        </div>

                        <!-- Message -->
                        <div>
                            <label class="block text-sm font-medium mb-2">Message Body</label>
                            <textarea 
                                id="body" 
                                class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 px-4 py-3 text-sm"
                                placeholder="Write your message... Use {name} and {company}"
                                rows="6"
                            ></textarea>
                        </div>

                        <!-- Generate Button -->
                        <button type="submit" class="w-full bg-gradient-to-r from-primary-500 to-secondary-500 text-white font-medium py-3 rounded-lg hover:opacity-90 transition-opacity">
                            Generate Campaign
                        </button>
                    </form>
                </div>
            </div>

            <!-- Right Column -->
            <div class="space-y-6">
                <!-- Dashboard -->
                <div class="bg-gradient-to-br from-primary-500 to-secondary-500 text-white rounded-xl p-6">
                    <h4 class="text-lg font-semibold mb-6">Campaign Progress</h4>
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div class="bg-white/10 rounded-xl p-4">
                            <div class="text-2xl font-bold" id="statsSent">0</div>
                            <div class="text-sm opacity-80">Sent</div>
                        </div>
                        <div class="bg-white/10 rounded-xl p-4">
                            <div class="text-2xl font-bold" id="statsPending">0</div>
                            <div class="text-sm opacity-80">Pending</div>
                        </div>
                    </div>
                </div>

                <!-- Email List -->
                <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h4 class="text-lg font-semibold">Generated Emails</h4>
                        <div class="flex gap-2">
                            <button id="filterAll" class="text-xs px-3 py-1 rounded-full bg-primary-100 dark:bg-primary-900/30 text-primary-700 dark:text-primary-300">
                                ALL
                            </button>
                            <button id="filterSent" class="text-xs px-3 py-1 rounded-full bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300">
                                SENT
                            </button>
                            <button id="filterPending" class="text-xs px-3 py-1 rounded-full bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300">
                                PENDING
                            </button>
                        </div>
                    </div>
                    
                    <div id="emailList" class="email-grid">
                        <div class="text-center py-8 text-gray-500 col-span-full">
                            <p class="font-medium">No emails generated yet</p>
                            <p class="text-sm mt-1">Set up your campaign and click "Generate"</p>
                        </div>
                    </div>
                    
                    <div class="flex justify-between text-sm mt-4 pt-4 border-t border-gray-100 dark:border-gray-700">
                        <button id="exportBtn" class="text-primary-600 dark:text-primary-400 hover:text-primary-700">
                            Export
                        </button>
                        <button id="clearAllBtn" class="text-red-600 dark:text-red-400 hover:text-red-700">
                            Clear All
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
    // AI Templates Database
    const aiTemplates = {
        sales: [
            {
                name: "Sales Pitch - High Conversion",
                subject: "Quick question about {company}'s growth",
                body: "Hi {name},\n\nI noticed {company} is doing impressive work in the industry. I have some ideas that could help accelerate your growth by 30-40%.\n\nWould you have 15 minutes this week for a quick chat?\n\nBest regards,\n[Your Name]"
            },
            {
                name: "Value Proposition",
                subject: "How {company} can save 20% on operations",
                body: "Hello {name},\n\nBased on my analysis of companies like {company}, I've identified opportunities to reduce operational costs by 20% while improving efficiency.\n\nInterested in learning more?\n\nKind regards,\n[Your Name]"
            }
        ],
        followup: [
            {
                name: "Gentle Follow-up",
                subject: "Following up on my previous email",
                body: "Hi {name},\n\nJust wanted to follow up on my previous email regarding opportunities for {company}.\n\nDid you get a chance to review it? I'd love to hear your thoughts.\n\nBest regards,\n[Your Name]"
            },
            {
                name: "Value-add Follow-up",
                subject: "Additional insights for {company}",
                body: "Hello {name},\n\nI was thinking more about {company}'s challenges and wanted to share an additional insight that might be helpful.\n\n[Insert specific insight]\n\nWould still love to connect if you're open to it.\n\nKind regards,\n[Your Name]"
            }
        ],
        networking: [
            {
                name: "Professional Connection",
                subject: "Connecting from the industry",
                body: "Hi {name},\n\nI came across your profile and was impressed by {company}'s work in the industry. I'd love to connect and learn more about your journey.\n\nWould you be open to a virtual coffee chat?\n\nBest regards,\n[Your Name]"
            }
        ],
        newsletter: [
            {
                name: "Monthly Newsletter",
                subject: "This month's insights for {company}",
                body: "Dear {name},\n\nHere are this month's insights that might be valuable for {company}:\n\n1. Industry trend analysis\n2. Best practices from top performers\n3. Upcoming opportunities\n\nLet me know if you'd like to discuss any of these further!\n\nBest,\n[Your Name]"
            }
        ]
    };

    // Quick Templates
    const quickTemplates = {
        professional: {
            subject: "Introduction from {company}",
            body: "Hi {name},\n\nI hope this email finds you well. I'm reaching out from {company} to introduce our services.\n\nWe specialize in helping businesses like yours achieve their goals through innovative solutions.\n\nWould you be open to a brief 15-minute call next week to discuss potential synergies?\n\nLooking forward to hearing from you.\n\nBest regards,\n[Your Name]"
        },
        followup: {
            subject: "Following up on our conversation",
            body: "Hi {name},\n\nI wanted to follow up on our previous conversation regarding {company}.\n\nI've been thinking about how we could potentially collaborate and wanted to share some additional thoughts.\n\nAre you available for a quick chat sometime this week?\n\nBest regards,\n[Your Name]"
        },
        cold: {
            subject: "Potential opportunity for {company}",
            body: "Hello {name},\n\nI came across {company} and was impressed by your recent achievements.\n\nI believe there might be an opportunity for us to work together. I have some ideas that could help you [achieve specific goal].\n\nWould you be interested in exploring this further?\n\nKind regards,\n[Your Name]"
        },
        partnership: {
            subject: "Partnership opportunity with {company}",
            body: "Dear {name},\n\nI'm writing to discuss a potential partnership opportunity between our companies.\n\nBased on {company}'s expertise and our capabilities, I believe we could create something truly remarkable together.\n\nWould you be open to discussing this possibility?\n\nWarm regards,\n[Your Name]"
        }
    };

    document.addEventListener('DOMContentLoaded', function() {
        // Theme Toggle
        const themeToggle = document.getElementById('themeToggle');
        themeToggle.addEventListener('click', () => {
            document.documentElement.classList.toggle('dark');
            localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
        });
        
        // Load saved theme
        if (localStorage.getItem('theme') === 'dark') {
            document.documentElement.classList.add('dark');
        }
        
        // State
        let campaignState = {
            emails: [],
            sentEmails: new Set(),
            currentFilter: 'all',
            subject: '',
            body: '',
            recipients: ''
        };
        
        // Initialize AI Templates
        function loadAITemplates(category = 'sales') {
            const container = document.getElementById('aiTemplates');
            const templates = aiTemplates[category] || [];
            
            container.innerHTML = '';
            
            if (templates.length === 0) {
                container.innerHTML = '<div class="text-center py-4 text-gray-500">No templates found</div>';
                return;
            }
            
            templates.forEach((template, index) => {
                const card = document.createElement('div');
                card.className = 'ai-template-card cursor-pointer';
                card.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <div class="font-medium text-gray-800 dark:text-gray-200">${template.name}</div>
                        <span class="ai-badge">AI</span>
                    </div>
                    <div class="text-sm text-gray-600 dark:text-gray-400 mb-3">${template.subject}</div>
                    <button class="text-sm text-primary-600 dark:text-primary-400 hover:text-primary-700 apply-template" 
                            data-index="${index}" data-category="${category}">
                        Apply Template
                    </button>
                `;
                container.appendChild(card);
            });
            
            // Add click handlers for apply buttons
            document.querySelectorAll('.apply-template').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const index = parseInt(this.dataset.index);
                    const category = this.dataset.category;
                    const template = aiTemplates[category][index];
                    
                    if (template) {
                        document.getElementById('subject').value = template.subject;
                        document.getElementById('body').value = template.body;
                        updateCounters();
                        showAlert(`Applied "${template.name}" template`, 'success');
                    }
                });
            });
            
            // Add click handlers for entire cards
            document.querySelectorAll('.ai-template-card').forEach((card, index) => {
                card.addEventListener('click', function(e) {
                    if (!e.target.closest('.apply-template')) {
                        const btn = this.querySelector('.apply-template');
                        if (btn) btn.click();
                    }
                });
            });
        }
        
        // Load initial AI templates
        loadAITemplates('sales');
        
        // AI Template Category Selection
        document.querySelectorAll('[data-category]').forEach(btn => {
            btn.addEventListener('click', function() {
                const category = this.dataset.category;
                
                // Update active state
                document.querySelectorAll('[data-category]').forEach(b => {
                    b.classList.remove('bg-primary-100', 'dark:bg-primary-900/30', 'text-primary-700', 'dark:text-primary-300');
                    b.classList.add('bg-gray-100', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
                });
                this.classList.remove('bg-gray-100', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
                this.classList.add('bg-primary-100', 'dark:bg-primary-900/30', 'text-primary-700', 'dark:text-primary-300');
                
                // Load templates
                loadAITemplates(category);
            });
        });
        
        // Generate AI Template Button
        document.getElementById('generateAiTemplate').addEventListener('click', function() {
            const categories = Object.keys(aiTemplates);
            const randomCategory = categories[Math.floor(Math.random() * categories.length)];
            const templates = aiTemplates[randomCategory];
            
            if (templates && templates.length > 0) {
                const randomTemplate = templates[Math.floor(Math.random() * templates.length)];
                
                document.getElementById('subject').value = randomTemplate.subject;
                document.getElementById('body').value = randomTemplate.body;
                updateCounters();
                showAlert(`Generated "${randomTemplate.name}" template`, 'success');
                
                // Show confetti for fun
                if (typeof confetti === 'function') {
                    confetti({
                        particleCount: 30,
                        spread: 70,
                        origin: { y: 0.6 }
                    });
                }
            }
        });
        
        // Quick Template Buttons
        document.querySelectorAll('[data-template]').forEach(btn => {
            btn.addEventListener('click', function() {
                const templateName = this.dataset.template;
                const template = quickTemplates[templateName];
                
                if (template) {
                    document.getElementById('subject').value = template.subject;
                    document.getElementById('body').value = template.body;
                    updateCounters();
                    showAlert(`Applied "${templateName}" template`, 'success');
                }
            });
        });
        
        // Load saved data
        function loadSavedData() {
            try {
                const saved = localStorage.getItem('hbee_campaign');
                if (saved) {
                    const data = JSON.parse(saved);
                    campaignState = data;
                    
                    // Restore form values
                    document.getElementById('subject').value = campaignState.subject || '';
                    document.getElementById('body').value = campaignState.body || '';
                    document.getElementById('recipients').value = campaignState.recipients || '';
                    
                    // Update counters
                    updateCounters();
                    
                    // Generate email list if we have emails
                    if (campaignState.emails.length > 0) {
                        generateEmailList();
                    }
                    
                    updateDashboard();
                }
            } catch (e) {
                console.log('No saved data found');
            }
        }
        
        // Save data
        function saveData() {
            localStorage.setItem('hbee_campaign', JSON.stringify(campaignState));
        }
        
        // Update counters
        function updateCounters() {
            const emails = document.getElementById('recipients').value.split('\n').filter(e => e.trim());
            const validEmails = emails.filter(isValidEmail);
            
            document.getElementById('validCount').textContent = validEmails.length;
            document.getElementById('totalCount').textContent = emails.length;
            
            // Update state
            campaignState.subject = document.getElementById('subject').value;
            campaignState.body = document.getElementById('body').value;
            campaignState.recipients = document.getElementById('recipients').value;
            
            // Save with debounce
            clearTimeout(window.saveTimer);
            window.saveTimer = setTimeout(saveData, 500);
        }
        
        // Email validation
        function isValidEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }
        
        // Generate email list with loading bar
        function generateEmailList() {
            const emailList = document.getElementById('emailList');
            const emails = campaignState.emails;
            
            if (emails.length === 0) {
                emailList.innerHTML = `
                    <div class="text-center py-8 text-gray-500 col-span-full">
                        <p class="font-medium">No emails generated yet</p>
                        <p class="text-sm mt-1">Set up your campaign and click "Generate"</p>
                    </div>
                `;
                return;
            }
            
            // Show loading bar
            const loader = document.getElementById('topLoader');
            const loaderText = document.getElementById('loaderText');
            loader.style.display = 'block';
            loaderText.style.display = 'block';
            loader.style.width = '0%';
            loaderText.textContent = 'Generating emails...';
            
            // Clear existing
            emailList.innerHTML = '';
            
            // Generate with progress
            let completed = 0;
            const total = emails.length;
            
            function processBatch(start, end) {
                for (let i = start; i < end; i++) {
                    const email = emails[i];
                    const isSent = campaignState.sentEmails.has(email);
                    
                    const item = document.createElement('div');
                    item.className = `email-item ${isSent ? 'sent' : ''}`;
                    item.innerHTML = `
                        <span class="email-number">${i + 1}.</span>
                        <span class="email-address" title="${email}">${email}</span>
                        <button class="send-btn ${isSent ? 'sent' : ''}" data-email="${email}">
                            <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M22 2L11 13M22 2L15 22L11 13M22 2L2 9L11 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    `;
                    emailList.appendChild(item);
                    
                    completed++;
                    
                    // Update progress
                    const progress = (completed / total) * 100;
                    loader.style.width = `${progress}%`;
                    loaderText.textContent = `Generated ${completed}/${total}`;
                }
                
                if (completed < total) {
                    // Next batch
                    setTimeout(() => processBatch(end, Math.min(end + 20, total)), 0);
                } else {
                    // Complete
                    setTimeout(() => {
                        loader.style.width = '100%';
                        loaderText.textContent = 'Complete!';
                        
                        setTimeout(() => {
                            loader.style.display = 'none';
                            loaderText.style.display = 'none';
                        }, 500);
                        
                        updateDashboard();
                        applyFilter();
                        showAlert(`Generated ${total} emails`, 'success');
                    }, 100);
                }
            }
            
            // Start processing in batches
            processBatch(0, Math.min(20, total));
        }
        
        // Send email
        function sendEmail(email) {
            if (!campaignState.subject || !campaignState.body) return;
            
            // Mark as sent
            campaignState.sentEmails.add(email);
            
            // Update UI
            const btn = document.querySelector(`[data-email="${email}"]`);
            if (btn) {
                btn.classList.add('sent');
                btn.closest('.email-item').classList.add('sent');
            }
            
            // Save and update
            saveData();
            updateDashboard();
            applyFilter();
            
            // Create mailto link
            const name = email.split('@')[0] || 'there';
            const company = email.split('@')[1]?.split('.')[0] || 'Company';
            
            const subject = encodeURIComponent(
                campaignState.subject.replace(/{name}/g, name).replace(/{company}/g, company)
            );
            
            const body = encodeURIComponent(
                campaignState.body.replace(/{name}/g, name).replace(/{company}/g, company)
            ).replace(/\n/g, '%0D%0A');
            
            const mailtoLink = `mailto:${email}?subject=${subject}&body=${body}`;
            
            // Open email client
            window.open(mailtoLink, '_blank');
            
            showAlert(`Email opened for ${email}`, 'success');
        }
        
        // Update dashboard
        function updateDashboard() {
            const total = campaignState.emails.length;
            const sent = campaignState.sentEmails.size;
            const pending = total - sent;
            
            document.getElementById('statsSent').textContent = sent;
            document.getElementById('statsPending').textContent = pending;
        }
        
        // Apply filter
        function applyFilter() {
            const items = document.querySelectorAll('.email-item');
            
            items.forEach(item => {
                const email = item.querySelector('.send-btn')?.dataset.email;
                const isSent = campaignState.sentEmails.has(email);
                
                if (campaignState.currentFilter === 'all') {
                    item.style.display = 'flex';
                } else if (campaignState.currentFilter === 'sent') {
                    item.style.display = isSent ? 'flex' : 'none';
                } else if (campaignState.currentFilter === 'pending') {
                    item.style.display = isSent ? 'none' : 'flex';
                }
            });
        }
        
        // Show alert
        function showAlert(message, type = 'info') {
            const alert = document.createElement('div');
            alert.className = `fixed top-5 right-5 left-5 max-w-md mx-auto p-4 rounded-xl shadow-lg z-50 ${
                type === 'success' ? 'bg-green-50 text-green-800 border border-green-200' :
                type === 'error' ? 'bg-red-50 text-red-800 border border-red-200' :
                'bg-blue-50 text-blue-800 border border-blue-200'
            }`;
            alert.textContent = message;
            document.body.appendChild(alert);
            
            setTimeout(() => {
                alert.remove();
            }, 3000);
        }
        
        // Form submission
        document.getElementById('campaignForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const emails = document.getElementById('recipients').value.split('\n')
                .map(e => e.trim())
                .filter(e => e && isValidEmail(e));
            
            if (emails.length === 0) {
                showAlert('Please add valid email addresses', 'error');
                return;
            }
            
            if (!document.getElementById('subject').value.trim()) {
                showAlert('Please enter a subject line', 'error');
                return;
            }
            
            if (!document.getElementById('body').value.trim()) {
                showAlert('Please enter a message body', 'error');
                return;
            }
            
            // Update state
            campaignState.emails = [...new Set(emails)]; // Remove duplicates
            campaignState.subject = document.getElementById('subject').value;
            campaignState.body = document.getElementById('body').value;
            campaignState.recipients = document.getElementById('recipients').value;
            
            // Save and generate
            saveData();
            generateEmailList();
        });
        
        // Email list click handler
        document.getElementById('emailList').addEventListener('click', function(e) {
            const sendBtn = e.target.closest('.send-btn');
            if (sendBtn && !sendBtn.classList.contains('sent')) {
                const email = sendBtn.dataset.email;
                sendEmail(email);
            }
        });
        
        // Filter buttons
        document.getElementById('filterAll').addEventListener('click', () => {
            campaignState.currentFilter = 'all';
            document.getElementById('filterAll').classList.add('bg-primary-100', 'text-primary-700');
            document.getElementById('filterSent').classList.remove('bg-primary-100', 'text-primary-700');
            document.getElementById('filterPending').classList.remove('bg-primary-100', 'text-primary-700');
            applyFilter();
        });
        
        document.getElementById('filterSent').addEventListener('click', () => {
            campaignState.currentFilter = 'sent';
            document.getElementById('filterSent').classList.add('bg-primary-100', 'text-primary-700');
            document.getElementById('filterAll').classList.remove('bg-primary-100', 'text-primary-700');
            document.getElementById('filterPending').classList.remove('bg-primary-100', 'text-primary-700');
            applyFilter();
        });
        
        document.getElementById('filterPending').addEventListener('click', () => {
            campaignState.currentFilter = 'pending';
            document.getElementById('filterPending').classList.add('bg-primary-100', 'text-primary-700');
            document.getElementById('filterAll').classList.remove('bg-primary-100', 'text-primary-700');
            document.getElementById('filterSent').classList.remove('bg-primary-100', 'text-primary-700');
            applyFilter();
        });
        
        // Input listeners
        document.getElementById('recipients').addEventListener('input', updateCounters);
        document.getElementById('subject').addEventListener('input', updateCounters);
        document.getElementById('body').addEventListener('input', updateCounters);
        
        // Export button
        document.getElementById('exportBtn').addEventListener('click', () => {
            if (campaignState.emails.length === 0) {
                showAlert('No emails to export', 'warning');
                return;
            }
            
            let emailsToExport = campaignState.emails;
            if (campaignState.currentFilter === 'sent') {
                emailsToExport = campaignState.emails.filter(email => campaignState.sentEmails.has(email));
            } else if (campaignState.currentFilter === 'pending') {
                emailsToExport = campaignState.emails.filter(email => !campaignState.sentEmails.has(email));
            }
            
            if (emailsToExport.length === 0) {
                showAlert('No emails match the current filter', 'warning');
                return;
            }
            
            const blob = new Blob([emailsToExport.join('\n')], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `emails-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showAlert(`Exported ${emailsToExport.length} emails`, 'success');
        });
        
        // Clear all button
        document.getElementById('clearAllBtn').addEventListener('click', () => {
            if (confirm('Clear all campaign data?')) {
                campaignState = {
                    emails: [],
                    sentEmails: new Set(),
                    currentFilter: 'all',
                    subject: '',
                    body: '',
                    recipients: ''
                };
                
                document.getElementById('subject').value = '';
                document.getElementById('body').value = '';
                document.getElementById('recipients').value = '';
                
                localStorage.removeItem('hbee_campaign');
                generateEmailList();
                updateCounters();
                updateDashboard();
                showAlert('All data cleared', 'success');
            }
        });
        
        // Initial load
        loadSavedData();
        updateCounters();
    });
    </script>
</body>
</html>
